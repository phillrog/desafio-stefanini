import{a as te}from"./chunk-CESGVCUF.js";import{Aa as D,C as d,Ca as O,D as r,E as t,Ea as z,F as m,Fa as L,G as x,Ga as J,H as c,Ha as Q,I as b,Ia as H,Ja as K,K as l,Ka as U,L as E,La as W,M as P,Ma as X,Na as Y,Oa as Z,Ua as $,V as w,Va as ee,W as N,X as k,Ya as ie,Z as A,a as S,ha as T,ja as j,k as _,ma as M,n as h,na as V,o as C,oa as R,s as v,sa as q,u as n,w as u,x as F,xa as B,y as I,ya as p,z as f,za as G}from"./chunk-HEUN4NMA.js";function ne(a,o){a&1&&(r(0,"small",36),l(1,"O nome \xE9 obrigat\xF3rio."),t())}function de(a,o){a&1&&(r(0,"small",36),l(1,"Insira um e-mail v\xE1lido."),t())}function ae(a,o){if(a&1){let e=x();r(0,"div",37)(1,"div",38)(2,"div",39)(3,"span",40),l(4),t()(),r(5,"div",41)(6,"label",42),l(7,"Produto"),t(),m(8,"p-select",43),t(),r(9,"div",44)(10,"label",42),l(11,"Quantidade"),t(),m(12,"p-inputNumber",45),t(),r(13,"div",46)(14,"p-button",47),c("onClick",function(){let s=h(e).index,y=b();return C(y.removerItem(s))}),t()()()()}if(a&2){let e=o.index,i=b();d("formGroupName",e),n(4),P("#",e+1),n(4),d("options",i.produtos())("filter",!0),n(4),d("min",1)("showButtons",!0),n(2),d("rounded",!0)("text",!0)}}function le(a,o){if(a&1){let e=x();r(0,"div",48),m(1,"i",49),r(2,"p",50),l(3,"Nenhum item adicionado ainda."),t(),r(4,"p-button",51),c("onClick",function(){h(e);let s=b();return C(s.adicionarItem())}),t()()}a&2&&(n(4),d("text",!0))}var g=class a{constructor(o,e,i,s,y,se){this.fb=o;this.apiService=e;this.router=i;this.route=s;this.messageService=y;this.confirmationService=se}pedidoForm;produtos=v([]);isEditando=v(!1);loading=v(!1);pedidoId=null;ngOnInit(){this.iniciarForm(),this.carregarProdutos(),this.route.paramMap.subscribe(o=>{let e=o.get("id");e&&(this.pedidoId=e,this.isEditando.set(!0),this.loadPedido(e))})}iniciarForm(){this.pedidoForm=this.fb.group({nomeCliente:["",p.required],emailCliente:["",[p.required,p.email]],pago:[!1],itens:this.fb.array([],p.required)}),this.isEditando()||this.adicionarItem()}get itens(){return this.pedidoForm.get("itens")}criarItem(){return this.fb.group({idProduto:[null,p.required],quantidade:[1,[p.required,p.min(1)]]})}adicionarItem(){this.itens.push(this.criarItem())}removerItem(o){this.itens.removeAt(o)}carregarProdutos(){this.apiService.getProdutos().subscribe({next:o=>{this.produtos.set(Array.isArray(o)?o:[])},error:o=>{console.error("Erro ao carregar produtos",o),this.produtos.set([])}})}loadPedido(o){this.loading.set(!0),this.apiService.getPedidoById(o).subscribe({next:e=>{this.pedidoForm.patchValue({nomeCliente:e.nomeCliente,emailCliente:e.emailCliente,pago:e.pago}),this.isEditando()&&(this.pedidoForm.get("nomeCliente")?.disable(),this.pedidoForm.get("emailCliente")?.disable()),this.itens.clear(),e.itensPedido.forEach(i=>{let s=this.criarItem();s.patchValue({idProduto:i.idProduto,quantidade:i.quantidade}),this.itens.push(s)}),this.loading.set(!1)},error:()=>this.voltar()})}onSubmit(){if(this.pedidoForm.invalid){this.pedidoForm.markAllAsTouched();return}this.confirmationService.confirm({message:this.isEditando()?"Deseja realmente salvar as altera\xE7\xF5es deste pedido?":"Confirma a cria\xE7\xE3o deste novo pedido?",header:"Confirmar A\xE7\xE3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Confirmar",rejectLabel:"Cancelar",acceptButtonStyleClass:"p-button-primary",rejectButtonStyleClass:"p-button-text",accept:()=>{this.salvar()}})}voltar(){this.router.navigate(["/pedidos"])}isFieldInvalid(o){let e=this.pedidoForm.get(o);return!!(e&&e.invalid&&(e.dirty||e.touched))}isItemInvalid(o,e){let i=this.itens.at(o).get(e);return!!(i&&i.invalid&&(i.dirty||i.touched))}salvar(){let o=this.pedidoForm.getRawValue(),e={nomeCliente:o.nomeCliente,emailCliente:o.emailCliente,pago:o.pago,itens:o.itens.map(i=>({idProduto:i.idProduto,quantidade:i.quantidade}))};this.isEditando()&&this.pedidoId?this.apiService.updatePedido(this.pedidoId,S({id:this.pedidoId},e)).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Sucesso",detail:"Pedido atualizado!"}),this.voltar()}}):this.apiService.createPedido(e).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Sucesso",detail:"Pedido criado!"}),this.voltar()}})}static \u0275fac=function(e){return new(e||a)(u(H),u(te),u(j),u(T),u(R),u(V))};static \u0275cmp=F({type:a,selectors:[["app-pedido-form"]],standalone:!1,decls:49,vars:16,consts:[[1,"card","border-none","shadow-3","m-2","md:m-5","border-round-xl","overflow-hidden","bg-white","dark:bg-surface-900"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center","p-4","bg-gray-50","dark:bg-surface-800","gap-3","border-bottom-1","border-300","dark:border-surface-700"],[1,"flex","align-items-center","gap-3"],[1,"w-3rem","h-3rem","bg-primary-500","border-round-lg","flex","align-items-center","justify-content-center","shadow-2"],[1,"text-white","text-xl","pi",3,"ngClass"],[1,"m-0","text-900","font-bold","line-height-2"],[1,"text-600"],["label","Voltar","icon","pi pi-arrow-left","severity","secondary",3,"onClick","text"],[1,"p-4","md:p-6",3,"ngSubmit","formGroup"],[1,"grid","p-fluid"],[1,"col-12","mb-3"],[1,"text-900","font-bold","text-lg","flex","align-items-center","gap-2"],[1,"pi","pi-id-card","text-primary-500"],[1,"col-12","md:col-6"],[1,"field"],["for","nome",1,"font-medium","text-700"],["iconPosition","left"],[1,"pi","pi-user"],["id","nome","type","text","pInputText","","formControlName","nomeCliente","placeholder","Ex: Jo\xE3o Silva",1,"w-full","border-round-lg"],["class","p-error block mt-1",4,"ngIf"],["for","email",1,"font-medium","text-700"],[1,"pi","pi-envelope"],["id","email","type","email","pInputText","","formControlName","emailCliente","placeholder","phill@email.com",1,"w-full","border-round-lg"],[1,"mt-5"],[1,"flex","justify-content-between","align-items-center","mb-3"],[1,"pi","pi-box","text-primary-500"],["label","Adicionar Item","icon","pi pi-plus","size","small","styleClass","border-round-pill",3,"onClick","text"],["formArrayName","itens",1,"flex","flex-column","gap-3"],["class","p-3 border-round-xl border-1 surface-border hover:border-primary-300 transition-all shadow-1 bg-white dark:bg-surface-800",3,"formGroupName",4,"ngFor","ngForOf"],["class","text-center p-5 border-2 border-dashed border-300 border-round-xl mt-3",4,"ngIf"],[1,"flex","flex-column","md:flex-row","justify-content-between","align-items-center","mt-6","pt-4","border-top-1","border-200"],[1,"mb-4","md:mb-0"],[3,"severity","value","rounded"],[1,"flex","gap-3","w-full","md:w-30rem"],["label","Cancelar","severity","secondary","styleClass","w-full p-button-lg",1,"flex-1",3,"onClick","outlined"],["type","submit","styleClass","w-full p-button-lg shadow-2",1,"flex-1",3,"label","icon","disabled"],[1,"p-error","block","mt-1"],[1,"p-3","border-round-xl","border-1","surface-border","hover:border-primary-300","transition-all","shadow-1","bg-white","dark:bg-surface-800",3,"formGroupName"],[1,"grid","p-fluid","align-items-center"],[1,"col-12","md:col-1","text-center","hidden","md:block"],[1,"text-500","font-bold"],[1,"field","col-12","md:col-6","m-0"],[1,"md:hidden","font-bold"],["formControlName","idProduto","optionLabel","nomeProduto","optionValue","id","placeholder","Selecione o produto","filterBy","nomeProduto","appendTo","body","styleClass","border-none bg-gray-50 dark:bg-surface-700",3,"options","filter"],[1,"field","col-12","md:col-3","m-0"],["formControlName","quantidade","buttonLayout","horizontal","inputId","horizontal","incrementButtonIcon","pi pi-plus","decrementButtonIcon","pi pi-minus","inputStyleClass","text-center",3,"min","showButtons"],[1,"col-12","md:col-2","flex","justify-content-end"],["icon","pi pi-trash","severity","danger","pTooltip","Remover",3,"onClick","rounded","text"],[1,"text-center","p-5","border-2","border-dashed","border-300","border-round-xl","mt-3"],[1,"pi","pi-shopping-cart","text-3xl","text-300","mb-3"],[1,"text-600","m-0"],["label","Adicionar primeiro item",3,"onClick","text"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m(4,"i",4),t(),r(5,"div")(6,"h2",5),l(7),t(),r(8,"small",6),l(9,"Gest\xE3o de vendas e processamento de itens"),t()()(),r(10,"p-button",7),c("onClick",function(){return i.voltar()}),t()(),m(11,"p-confirmDialog"),r(12,"form",8),c("ngSubmit",function(){return i.onSubmit()}),r(13,"div",9)(14,"div",10)(15,"span",11),m(16,"i",12),l(17," Informa\xE7\xF5es do Cliente "),t()(),r(18,"div",13)(19,"div",14)(20,"label",15),l(21,"Nome"),t(),r(22,"p-iconfield",16),m(23,"p-inputicon",17)(24,"input",18),t(),f(25,ne,2,0,"small",19),t()(),r(26,"div",13)(27,"div",14)(28,"label",20),l(29,"E-mail"),t(),r(30,"p-iconfield",16),m(31,"p-inputicon",21)(32,"input",22),t(),f(33,de,2,0,"small",19),t()()(),r(34,"div",23)(35,"div",24)(36,"span",11),m(37,"i",25),l(38," Itens do Pedido "),t(),r(39,"p-button",26),c("onClick",function(){return i.adicionarItem()}),t()(),r(40,"div",27),f(41,ae,15,8,"div",28),t(),f(42,le,5,1,"div",29),t(),r(43,"div",30)(44,"div",31),m(45,"p-tag",32),t(),r(46,"div",33)(47,"p-button",34),c("onClick",function(){return i.voltar()}),t(),m(48,"p-button",35),t()()()()),e&2&&(n(4),d("ngClass",i.isEditando()?"pi-pencil":"pi-plus"),n(3),E(i.isEditando()?"Editar Pedido":"Novo Pedido"),n(3),d("text",!0),n(2),d("formGroup",i.pedidoForm),n(13),d("ngIf",i.isFieldInvalid("nomeCliente")),n(8),d("ngIf",i.isFieldInvalid("emailCliente")),n(6),d("text",!0),n(2),d("ngForOf",i.itens.controls),n(),d("ngIf",i.itens.length===0),n(3),d("severity",i.pedidoForm.invalid?"danger":"success")("value",i.pedidoForm.invalid?"Formul\xE1rio Incompleto":"Pronto para Salvar")("rounded",!0),n(2),d("outlined",!0),n(),d("label",i.isEditando()?"Atualizar":"Salvar Pedido")("icon",i.loading()?"pi pi-spin pi-spinner":"pi pi-check")("disabled",i.pedidoForm.invalid||i.loading()))},dependencies:[w,N,k,O,B,G,D,Q,J,z,L,q,K,Z,$,U,Y,W,X,ee],styles:[".field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}"]})};var me=[{path:"",component:g}],oe=class a{static \u0275fac=function(e){return new(e||a)};static \u0275mod=I({type:a});static \u0275inj=_({imports:[A,ie,M.forChild(me)]})};export{oe as PedidoFormModule};
